---
title: "Data Cleanup"
author: "Josephine Decker"
date: "2023-09-15"
output: html_document
---


```{r}
library(tidyverse)
library(dplyr)
```



```{r}
DAWBA <- read_csv("DAWBA_database.csv")
view(DAWBA)
#View(DAWBA)

```


#### Cleaning DAWBA 

##### Data with written responses (Youth)

1. got rid of any columns with a percentage of NA's greater than 60%. 
2. Looked at the sections with the greatest amount of questions left.
3. Decided to only include questions answered by the youth. Of the questions both answered by the youth and the parents, 79% of the time the parent rated them more likely in each section. 
4. Sections that are included in final data set : BDD, Depression, DMDD, Generalized Anxiety, OCD. 
5. Final data set has a 98 questions and 1 identifier variable. 
6. Re-coded the numeric data to have the written answers instead. 
```{r}
dim(DAWBA)

w_DAWBA <- DAWBA[, colMeans(is.na(DAWBA)) <= .60]  #getting rid of the columns with a percentage of NAs greater than 60%

dim(w_DAWBA) #checking the dimensions after cutting the previous columns.

w_DAWBA <- w_DAWBA[, -c(517:531)] #deleting the "other concerns" questions

w_DAWBA <- w_DAWBA[, -c(240:251)] #deleting the heights and weights

w_DAWBA <- w_DAWBA[, -c(2:56)] #deleting general + Prediction sections

dim(w_DAWBA) #checking dimensions after deletions of non necessary questions


#Deleting all the questions that are the youth answers of Depression, DMDD, Generalized Anxiety, OCD, BDD

w_DAWBA <- w_DAWBA[, -c(2:107, 136:143, 173:203, 221:239, 256:278, 289:449)]

w_DAWBA <- w_DAWBA[, -c(12)]
#view(w_DAWBA)

dim(w_DAWBA) #One identifier and 99 questions




# Re-coding the variables from numeric to written response ------- BDD Section
w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(2:18), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "a little",
    . == 2 ~ "a lot"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(19:20), ~ case_when(
    . == 0 ~ "little or no time",
    . == 1 ~ "less than an hour",
    . == 2 ~ "about an hour",
    . == 3 ~ "a few hours",
    . == 4 ~ "many hours" ))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(21:22), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "perhaps",
    . == 2 ~ "definitely"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(23:28), ~ case_when(
    . == 0 ~ "not at all",
    . == 1 ~ "a little",
    . == 2 ~ "a medium amount",
    . == 3 ~ "a great deal"))

# --------------------------------- Depression Section

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(29:31, 34:36, 39:41, 43:51), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "yes"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(32,37), ~ case_when(
    . == 0 ~ "easily",
    . == 1 ~ "with difficulty/only briefly",
    . == 2 ~ "not at all"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(33,38,42), ~ case_when(
    . == 0 ~ "less than 2 weeks",
    . == 1 ~ "2 weeks or more"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(52:57), ~ case_when(
    . == 0 ~ "not at all",
    . == 1 ~ "a little",
    . == 2 ~ "a medium amount",
    . == 3 ~ "a great deal"))

#------------------------------------ DMDD Section

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(58:59), ~ case_when(
    . == 0 ~ "never",
    . == 1 ~ "occasionally",
    . == 2 ~ "once or twice a week",
    . == 3 ~ "three or more times a week",
    . == 4 ~ "every day"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(60:61, 64:66, 68), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "a little",
    . == 2 ~ "a lot"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(62), ~ case_when(
    . == 0 ~ "no more than a few minutes",
    . == 1 ~ "less than an hour",
    . == 2 ~ "a few hours",
    . == 3 ~ "most or all of the day"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(63, 70:74), ~ case_when(
    . == 0 ~ "not at all",
    . == 1 ~ "a little",
    . == 2 ~ "a medium amount",
    . == 3 ~ "a great deal"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(67), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "yes"))

#--------------------------------- Generalized Anxiety Section

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(75:76, 89:90), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "yes"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(77), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "perhaps",
    . == 2 ~ "definitely"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(78:88), ~ case_when(
    . == 0 ~ "no more than others",
    . == 1 ~ "a little more than others",
    . == 2 ~ "a lot more than others"))

#----------------------------------- OCD Section

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(91), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "yes"))

w_DAWBA <- w_DAWBA %>%
  mutate_at(vars(92:100), ~ case_when(
    . == 0 ~ "no",
    . == 1 ~ "a little",
    . == 2 ~ "a lot"))

w_DAWBA <- w_DAWBA[, -c(69)]


w_DAWBA <- w_DAWBA[-c(9, 64, 78, 82, 102, 113, 118, 131, 137),]
view(w_DAWBA)

# saving the file
#file_path <- "w_DAWBA.csv"
#write.csv(w_DAWBA, file = file_path, row.names = FALSE)

```
##### Looking into what percentage NA's in the rows

```{r}
percentage_na <- rowSums(is.na(w_DAWBA)) / ncol(w_DAWBA) * 100
w_DAWBA$PercentageNA <- percentage_na

w_DAWBA<- w_DAWBA%>%
  arrange(PercentageNA)
view(w_DAWBA)
```


```{r}
value_counts <- table(w_DAWBA$PercentageNA)
result <- data.frame(
  PercentNA = names(value_counts),
  Count = as.vector(value_counts))
  
print(result)
```

```{r}
C <- read_csv("clinical_database.csv")
#view(C)
```
```{r}
Csub <- C%>%
  select(SDAN, SEX, Participant_Type2, Age_at_visit)
```



```{r}
specific_SDAN_values <- c(20900, 21669, 21748, 22228, 22409, 22477, 22658, 22686, 22686, 22694, 22695, 22698, 22699, 22742, 22812, 22823, 22892, 23017, 23108, 23123, 23199, 23303, 23458, 23482, 23490, 23501, 23502, 23513, 23520, 23528, 23540, 23546, 23549, 23550, 23553, 23554, 23557, 23564, 23566, 23574, 23576, 23593, 23607, 23613, 23625, 23630, 23638, 23639, 23641, 23643, 23644, 23649, 23652, 23660, 23668, 23672, 23673, 23674, 23676, 23689, 23692, 23693, 23717, 23717, 23718, 23720, 23732, 23745, 23746, 23748, 23753, 23757, 23759, 23765, 23766, 23767, 23770, 23770, 23772, 23777, 23780, 23780, 23783, 23798, 23809, 23810, 23813, 23814, 23817, 23818, 23820, 23823, 23824, 23825, 23830, 23834, 23843, 23848, 23849, 23852, 23856, 23857, 23857, 23866, 23867, 23880, 23886, 23890, 23895, 23896, 23900, 23901, 23901, 23903, 23905, 23906, 23907, 23907, 23911, 23919, 23924, 23927, 23935, 23937, 23943, 23944, 23951, 23952, 23957, 23969, 23969, 23980, 23986, 23988, 24014, 24028, 24028, 24036, 24037, 24043, 24047, 24048, 24052, 24054, 24057, 24059, 24060, 24061, 24064, 24065, 24071, 24077, 24078, 24080, 24085, 24088, 24092, 24093, 24103, 24107, 24110, 24111, 24112, 24113, 24114, 24116, 24120, 24123, 24126, 24128, 24135, 24137, 24138, 24156, 24167, 24168, 24169, 24172, 24174, 24175, 24176, 24177, 24180, 24185, 24186, 24187, 24192, 24199, 24201, 24204, 24208, 24213, 24216, 24225, 24226, 24227, 24229, 24232, 24235, 24238, 24242, 24247, 24252, 24256, 24257, 24259, 24263, 24264, 24267, 24270, 24280, 24281, 24282, 24285, 24286, 24287, 24293, 24295, 24296, 24297, 24298, 24301, 24304, 24305, 24307, 24309, 24310, 24311, 24315, 24317, 24319, 24324, 24327, 24347, 24352, 24356, 24358, 24363, 24364, 24365, 24370, 24371, 24376, 24377, 24378, 24379, 24380, 24381, 24384, 24385, 24389, 24390, 24398, 24404, 24409, 24416, 24422)

```

```{r}
filtered_Csub <- Csub %>%
  filter(SDAN %in% specific_SDAN_values)

#view(filtered_Csub)
```

```{r}

result <- filtered_Csub %>%
  group_by(SDAN, SEX, Participant_Type2) %>%
  summarize(min_age = min(Age_at_visit, na.rm = TRUE))

result <- result %>%
  mutate(min_age = round(min_age))

result <- result[-c(19, 115,119, 126, 159, 161, 168, 173, 186, 209, 222, 244),]  #deleting doubles

#view(result)
```




```{r}
finalSet<- cbind(result,w_DAWBA)

finalSet<- finalSet[, -c(5)]


finalSet <- finalSet %>%
  rename(SDAN = SDAN...1)

# saving the file
#file_path <- "finalSet.csv"
#write.csv(finalSet, file = file_path, row.names = FALSE)

#view(finalSet)


```

```{r}
finalSet%>%
  count(SEX)
```
```{r}
ggplot(finalSet, aes(SEX))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE) +
  facet_wrap(~Participant_Type2)
```

```{r}
ggplot(finalSet, aes(SEX))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE) +
  facet_wrap(~ min_age)
```

```{r}
ggplot(finalSet, aes(Participant_Type2))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE) +
  facet_wrap(~ min_age)
```



#### Training/Testing Data

creating the data set of 0 NAs to start working on 
```{r}
G1 <- finalSet%>%
  filter(PercentageNA == 0)

view(G1)

```


```{r}
set.seed(12345)

train <- 2/3
test <- 1/3

ns <- nrow(G1)
ntrain <- round(train * ns)
ntest <- ns - ntrain

trainI <- sample(1:ns, ntrain)

train_data <- G1[trainI, ] 
test_data <- G1[-trainI, ]

view(train_data)
view(test_data)


file_path <- "train_data.csv"
write.csv(train_data, file = file_path, row.names = FALSE)

file_path <- "test_data.csv"
write.csv(test_data, file = file_path, row.names = FALSE)
```

```{r}
train_data%>%
  count(SEX)
```
```{r}
test_data%>%
  count(SEX)
```
```{r}
ggplot(train_data, aes(Participant_Type2))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE)
```
```{r}
ggplot(test_data, aes(Participant_Type2))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE)
```

```{r}
summary(train_data$min_age)
```
```{r}
summary(test_data$min_age)
```


```{r}
ggplot(train_data, aes(min_age))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE)
```

```{r}
ggplot(test_data, aes(min_age))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE)
```


```{r}
ggplot(train_data, aes(Participant_Type2))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE) +
  facet_wrap(~min_age)
```

```{r}
ggplot(test_data, aes(Participant_Type2))+
  geom_bar(stat = "count")+
  geom_text(stat = "count", aes(label = after_stat(count), vjust = -0.5), show.legend = FALSE) +
  facet_wrap(~min_age)
```





#### Final dataset w/ numeric data 

```{r}
dim(DAWBA)

n_DAWBA <- DAWBA[, colMeans(is.na(DAWBA)) <= .60]
dim(n_DAWBA)

n_DAWBA <- n_DAWBA[, -c(517:531)] #deleting the "other concerns" questions

n_DAWBA <- n_DAWBA[, -c(240:251)] #deleting the heights and weights

n_DAWBA <- n_DAWBA[, -c(2:56)] #deleting general + Prediction sections

dim(n_DAWBA) #checking dimensions after deletions of non necessary questions


#Deleting all the questions that are the youth answers of Depression, DMDD, Generalized Anxiety, OCD, BDD

n_DAWBA <- n_DAWBA[, -c(2:107, 136:143, 173:203, 221:239, 256:278, 289:449)]

n_DAWBA <- n_DAWBA[, -c(12)]
n_DAWBA <- n_DAWBA[, -c(69)]

#view(w_DAWBA)

dim(n_DAWBA) #One identifier and 99 questions

#view(n_DAWBA)
```

Adding in Means per section
```{r}
n_DAWBA$MeanBDD <- rowMeans(n_DAWBA[, 2:28],na.rm=TRUE)
n_DAWBA$MeanDep <- rowMeans(n_DAWBA[, 29:57],na.rm=TRUE)
n_DAWBA$MeanDMDD <- rowMeans(n_DAWBA[, 58:73],na.rm=TRUE)
n_DAWBA$MeanGenA <- rowMeans(n_DAWBA[, 74:89],na.rm=TRUE)
n_DAWBA$MeanOCD <- rowMeans(n_DAWBA[, 90:99],na.rm=TRUE)
```

```{r}
#view(n_DAWBA)
```
